"""
verifier.py
AI Output Verification Engine (Hackathon Version)
"""

from typing import List, Dict
import re


def extract_claims(text: str) -> List[str]:
    sentences = re.split(r'[.!?]\s+', text)
    claims = [s.strip() for s in sentences if len(s.strip()) > 10]
    return claims


def hallucination_score(claims: List[str]) -> Dict:
    suspicious_keywords = [
        "study proves",
        "research shows",
        "according to a report",
        "it is proven that",
        "experts say"
    ]

    flagged = []
    for c in claims:
        for kw in suspicious_keywords:
            if kw in c.lower():
                flagged.append(c)

    total = len(claims)
    flagged_count = len(flagged)

    percentage = 0
    if total > 0:
        percentage = int((flagged_count / total) * 100)

    return {
        "total_claims": total,
        "flagged_claims": flagged_count,
        "hallucination_percentage": percentage,
        "flagged_examples": flagged[:3]
    }


def verify_ai_output(prompt: str, ai_response: str) -> Dict:
    claims = extract_claims(ai_response)
    analysis = hallucination_score(claims)

    verdict = "SAFE"
    if analysis["hallucination_percentage"] > 40:
        verdict = "UNSAFE"
    elif analysis["hallucination_percentage"] > 20:
        verdict = "CAUTION"

    confidence_score = 100 - analysis["hallucination_percentage"]

    return {
        "prompt": prompt,
        "verdict": verdict,
        "confidence_score": confidence_score,  
        "analysis": analysis
    }

